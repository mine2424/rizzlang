# ============================================================
# RizzLang â€” é–‹ç™ºã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
# ============================================================
# ä½¿ã„æ–¹:
#   make setup       åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆä¾å­˜ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« + ãƒ­ãƒ¼ã‚«ãƒ«èµ·å‹•ï¼‰
#   make local-start Supabase ãƒ­ãƒ¼ã‚«ãƒ«èµ·å‹• + ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é©ç”¨
#   make local-stop  Supabase ãƒ­ãƒ¼ã‚«ãƒ«åœæ­¢
#   make run         Flutter å®Ÿè¡Œï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿æ¥ç¶šï¼‰
#   make run-device  Flutter ã‚’ç‰©ç†ãƒ‡ãƒã‚¤ã‚¹ã§å®Ÿè¡Œï¼ˆIP è¦æŒ‡å®šï¼‰
#   make test        ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
#   make clean       ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
# ============================================================

.PHONY: setup local-start local-stop local-reset run run-device local-ip test clean help

# â”€â”€ ç‰©ç†ãƒ‡ãƒã‚¤ã‚¹æ¥ç¶šæ™‚ã® Mac ã® LAN IPï¼ˆå¤‰æ›´ã—ã¦ãã ã•ã„ï¼‰â”€â”€
LOCAL_HOST ?= $(shell ipconfig getifaddr en0 2>/dev/null || hostname -I 2>/dev/null | awk '{print $$1}')

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
setup:
	@echo "ğŸ”§ RizzLang ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ã¾ã™..."
	@command -v supabase >/dev/null 2>&1 || { echo "âŒ Supabase CLI ãŒå¿…è¦ã§ã™: brew install supabase/tap/supabase"; exit 1; }
	@command -v flutter >/dev/null 2>&1 || { echo "âŒ Flutter SDK ãŒå¿…è¦ã§ã™: https://flutter.dev/docs/get-started/install"; exit 1; }
	flutter pub get
	@$(MAKE) local-start
	@echo "âœ… ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†ï¼'make run' ã§èµ·å‹•ã—ã¦ãã ã•ã„"

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Supabase ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ èµ·å‹•
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
local-start:
	@echo "ğŸš€ Supabase ãƒ­ãƒ¼ã‚«ãƒ«ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã‚’èµ·å‹•ã—ã¾ã™..."
	supabase start
	@echo "ğŸ“¦ ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é©ç”¨ã—ã¾ã™..."
	supabase db reset
	@echo ""
	@echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
	@echo "â•‘  Supabase ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒ èµ·å‹•å®Œäº†ï¼               â•‘"
	@echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
	@echo "â•‘  API:    http://127.0.0.1:54321                â•‘"
	@echo "â•‘  Studio: http://127.0.0.1:54323                â•‘"
	@echo "â•‘  Email:  http://127.0.0.1:54324  (å—ä¿¡ç¢ºèª)    â•‘"
	@echo "â•‘                                                 â•‘"
	@echo "â•‘  ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼: test@rizzlang.local           â•‘"
	@echo "â•‘  ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰:     test1234                       â•‘"
	@echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Supabase ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ åœæ­¢
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
local-stop:
	@echo "ğŸ›‘ Supabase ãƒ­ãƒ¼ã‚«ãƒ«ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã‚’åœæ­¢ã—ã¾ã™..."
	supabase stop

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# DB ãƒªã‚»ãƒƒãƒˆï¼ˆãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ + ã‚·ãƒ¼ãƒ‰å†é©ç”¨ï¼‰
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
local-reset:
	@echo "ğŸ”„ DB ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ï¼ˆãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ + ã‚·ãƒ¼ãƒ‰å†é©ç”¨ï¼‰..."
	supabase db reset
	@echo "âœ… DB ãƒªã‚»ãƒƒãƒˆå®Œäº†"

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Edge Functions ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§ serve
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
functions-serve:
	@echo "âš¡ Edge Functions ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§èµ·å‹•ã—ã¾ã™..."
	supabase functions serve --env-file supabase/.env.local

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Flutter å®Ÿè¡Œï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ / ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ï¼‰
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
run:
	flutter run \
		--dart-define=ENV=local \
		--dart-define=RC_IOS_KEY=appl_dummy_local \
		--dart-define=RC_ANDROID_KEY=goog_dummy_local

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Flutter å®Ÿè¡Œï¼ˆç‰©ç†ãƒ‡ãƒã‚¤ã‚¹ï¼‰
# Mac ã® LAN IP ã«è‡ªå‹•æ¥ç¶š
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
run-device:
	@echo "ğŸ“± ç‰©ç†ãƒ‡ãƒã‚¤ã‚¹ã§èµ·å‹•ã—ã¾ã™ï¼ˆSupabase: http://$(LOCAL_HOST):54321ï¼‰"
	flutter run \
		--dart-define=ENV=local \
		--dart-define=LOCAL_HOST=$(LOCAL_HOST) \
		--dart-define=RC_IOS_KEY=appl_dummy_local \
		--dart-define=RC_ANDROID_KEY=goog_dummy_local

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Mac ã® LAN IP ç¢ºèª
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
local-ip:
	@echo "ğŸŒ Mac ã® LAN IP: $(LOCAL_HOST)"
	@echo "   ç‰©ç†ãƒ‡ãƒã‚¤ã‚¹ç”¨: make run-device LOCAL_HOST=$(LOCAL_HOST)"

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
test:
	flutter test

test-unit:
	flutter test test/unit/

test-widget:
	flutter test test/widget/

test-coverage:
	flutter test --coverage
	genhtml coverage/lcov.info -o coverage/html
	open coverage/html/index.html

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ãƒ“ãƒ«ãƒ‰
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
build-ios:
	flutter build ipa \
		--dart-define=ENV=production \
		--dart-define=SUPABASE_URL=$(SUPABASE_URL) \
		--dart-define=SUPABASE_ANON_KEY=$(SUPABASE_ANON_KEY) \
		--dart-define=RC_IOS_KEY=$(RC_IOS_KEY) \
		--obfuscate \
		--split-debug-info=build/debug-info/ios

build-android:
	flutter build appbundle \
		--dart-define=ENV=production \
		--dart-define=SUPABASE_URL=$(SUPABASE_URL) \
		--dart-define=SUPABASE_ANON_KEY=$(SUPABASE_ANON_KEY) \
		--dart-define=RC_ANDROID_KEY=$(RC_ANDROID_KEY) \
		--obfuscate \
		--split-debug-info=build/debug-info/android

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
clean:
	flutter clean
	flutter pub get
	@echo "âœ… ã‚¯ãƒªãƒ¼ãƒ³å®Œäº†"

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ãƒ˜ãƒ«ãƒ—
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
help:
	@echo ""
	@echo "RizzLang é–‹ç™ºã‚³ãƒãƒ³ãƒ‰ä¸€è¦§"
	@echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
	@echo "  make setup          åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—"
	@echo "  make local-start    Supabase ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿èµ·å‹• + DB ãƒªã‚»ãƒƒãƒˆ"
	@echo "  make local-stop     Supabase ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿åœæ­¢"
	@echo "  make local-reset    DB ãƒªã‚»ãƒƒãƒˆï¼ˆãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ + ã‚·ãƒ¼ãƒ‰å†é©ç”¨ï¼‰"
	@echo "  make functions-serve Edge Functions ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§èµ·å‹•"
	@echo "  make run            Flutter å®Ÿè¡Œï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ï¼‰"
	@echo "  make run-device     Flutter å®Ÿè¡Œï¼ˆç‰©ç†ãƒ‡ãƒã‚¤ã‚¹ï¼‰"
	@echo "  make local-ip       Mac ã® LAN IP ç¢ºèª"
	@echo "  make test           ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆå…¨ä»¶ï¼‰"
	@echo "  make test-unit      ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®ã¿"
	@echo "  make test-widget    Widget ãƒ†ã‚¹ãƒˆã®ã¿"
	@echo "  make build-ios      iOS ãƒªãƒªãƒ¼ã‚¹ãƒ“ãƒ«ãƒ‰"
	@echo "  make build-android  Android ãƒªãƒªãƒ¼ã‚¹ãƒ“ãƒ«ãƒ‰"
	@echo "  make clean          ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢"
	@echo ""
