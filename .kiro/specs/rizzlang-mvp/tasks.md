# Implementation Tasks â€” RizzLang MVP

## ã‚¿ã‚¹ã‚¯ä¸€è¦§

---

- [ ] 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŸºç›¤ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

- [ ] 1.1 Next.js + TypeScript + Tailwind ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
  - `npx create-next-app@latest` ã§ App Router + TypeScript + Tailwind ã‚’æœ‰åŠ¹åŒ–
  - shadcn/ui ã‚’åˆæœŸåŒ–ã—ã€Button, Card, Input, Dialog ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
  - Framer Motion ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
  - ESLint / Prettier ã‚’è¨­å®šã—ã€åž‹å®‰å…¨ãªãƒ«ãƒ¼ãƒ«ã‚’æœ‰åŠ¹åŒ–ï¼ˆ`strict: true`ï¼‰
  - GitHub ãƒªãƒã‚¸ãƒˆãƒªä½œæˆ + Vercel ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨é€£æº
  - _Requirements: 10.1_

- [ ] 1.2 (P) Supabase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã¨ã‚¹ã‚­ãƒ¼ãƒžå®šç¾©
  - Supabase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã€æŽ¥ç¶šURLã¨ anon/service ã‚­ãƒ¼ã‚’å–å¾—
  - `users`, `characters`, `conversations`, `scenario_templates`, `user_scenario_progress`, `vocabulary`, `usage_logs`, `push_subscriptions` ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’è¨­è¨ˆæ›¸ã®å®šç¾©é€šã‚Šã«ä½œæˆ
  - å…¨ãƒ†ãƒ¼ãƒ–ãƒ«ã« RLS ã‚’æœ‰åŠ¹åŒ–ã— `auth.uid() = user_id` ãƒãƒªã‚·ãƒ¼ã‚’è¨­å®š
  - `conversations` ãƒ†ãƒ¼ãƒ–ãƒ«ã® `(user_id, character_id, date)` è¤‡åˆãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„ã‚’è¨­å®š
  - `vocabulary` ãƒ†ãƒ¼ãƒ–ãƒ«ã® `(user_id, word, language)` è¤‡åˆãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„ã‚’è¨­å®š
  - `next_review` ã‚«ãƒ©ãƒ ã«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½œæˆ
  - Supabase CLI ã§ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã«è¿½åŠ 
  - _Requirements: 1.5, 10.1, 10.2_

- [ ] 1.3 (P) ç’°å¢ƒå¤‰æ•°ã¨åž‹å®šç¾©ã®æ•´å‚™
  - `.env.local.example` ã«å¿…è¦ãªç’°å¢ƒå¤‰æ•°ã‚’åˆ—æŒ™ï¼ˆSUPABASE_URL, SUPABASE_ANON_KEY, SUPABASE_SERVICE_ROLE_KEY, GEMINI_API_KEY, STRIPE_SECRET_KEY, STRIPE_WEBHOOK_SECRETï¼‰
  - `types/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã« `User`, `Character`, `Conversation`, `Message`, `Scenario`, `VocabEntry`, `GeneratedReply`, `SlangItem` ã®åž‹å®šç¾©ã‚’ä½œæˆ
  - Supabase ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ / ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ä¸¡ç”¨ã§åˆæœŸåŒ–ã™ã‚‹ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚’ä½œæˆ
  - _Requirements: 10.1_

---

- [ ] 2. èªè¨¼ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†

- [ ] 2.1 Google / Apple OAuth ãƒ­ã‚°ã‚¤ãƒ³å®Ÿè£…
  - Supabase Auth ã§ Google OAuth ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’æœ‰åŠ¹åŒ–ã—ã€OAuth ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã‚’è¨­å®š
  - Apple Sign In ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’è¨­å®š
  - ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆï¼ˆGoogle / Apple ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ï¼‰
  - Supabase ã® `onAuthStateChange` ã‚’ãƒ•ãƒƒã‚¯ã—ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹ Context ã‚’å®Ÿè£…
  - ãƒ­ã‚°ã‚¤ãƒ³å®Œäº†å¾Œã«ãƒ›ãƒ¼ãƒ ç”»é¢ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…
  - _Requirements: 1.1, 1.2_

- [ ] 2.2 åˆå›žãƒ­ã‚°ã‚¤ãƒ³æ™‚ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆ
  - Supabase Auth ã® `auth.users` ã«å¯¾ã—ã¦ `users` ãƒ†ãƒ¼ãƒ–ãƒ«ã¸ã®è‡ªå‹•æŒ¿å…¥ãƒˆãƒªã‚¬ãƒ¼ã‚’è¨­å®šï¼ˆSupabase Database Function ä½¿ç”¨ï¼‰
  - åˆå›žãƒ­ã‚°ã‚¤ãƒ³æ™‚ã« `plan=free`, `streak=0`, `current_level=1` ã§åˆæœŸåŒ–ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
  - `user_scenario_progress` ã«ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ï¼ˆåœ°ìš°ï¼‰ã®åˆæœŸé€²æ—ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆ
  - _Requirements: 1.3_

- [ ] 2.3 ã‚»ãƒƒã‚·ãƒ§ãƒ³è‡ªå‹•æ›´æ–°ã¨ãƒ«ãƒ¼ãƒˆä¿è­·
  - Next.js Middleware ã§æœªèªè¨¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
  - Supabase ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³è‡ªå‹•æ›´æ–°ãŒæ©Ÿèƒ½ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
  - Server Actions ã§ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã”ã¨ã« `auth.getUser()` ã§ã‚»ãƒƒã‚·ãƒ§ãƒ³æ¤œè¨¼ã™ã‚‹ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’å®Ÿè£…
  - _Requirements: 1.4, 10.2_

---

- [ ] 3. ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ•ãƒ­ãƒ¼

- [ ] 3.1 ãƒ‡ãƒ¢ãƒãƒ£ãƒƒãƒˆç”»é¢ï¼ˆã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—å‰ã®ä¾¡å€¤ä½“é¨“ï¼‰
  - æœªèªè¨¼ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã«ã‚·ãƒŠãƒªã‚ªDay 1ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒ—ãƒªã‚»ãƒƒãƒˆã—ãŸãƒ‡ãƒ¢ç”»é¢ã‚’ä½œæˆ
  - ãƒ‡ãƒ¢ç”¨ã® `generateDemoReply` Server Action ã‚’å®Ÿè£…ï¼ˆèªè¨¼ä¸è¦ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¿å­˜ãªã—ï¼‰
  - 1å›žç›®ã®è¿”ä¿¡ã¯ãã®ã¾ã¾ä½“é¨“ã•ã›ã€2å›žç›®ã§ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
  - _Requirements: 2.1, 2.2, 2.3_

- [ ] 3.2 ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘¼ç§°ã®é¸æŠž
  - ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã®é€”ä¸­ã§ã€Œåœ°ìš°ã‹ã‚‰ã©ã†å‘¼ã°ã‚ŒãŸã„ã§ã™ã‹ï¼Ÿã€é¸æŠžç”»é¢ã‚’è¡¨ç¤º
  - ã€Œã‚ªãƒƒãƒ‘ / ìžê¸°ì•¼ / ã‚«ã‚¹ã‚¿ãƒ å…¥åŠ›ã€ã®3æŠžã‚’æä¾›
  - é¸æŠžã—ãŸå‘¼ç§°ã‚’ `users.user_call_name` ã«ä¿å­˜
  - _Requirements: 2.4_

- [ ] 3.3 ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å®Œäº†å¾Œã®åˆæœŸã‚·ãƒ¼ãƒ³é–‹å§‹
  - ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å®Œäº†æ™‚ã« `user_scenario_progress` ã‚’ season=1, week=1, day=1 ã«è¨­å®š
  - å®Œäº†ç›´å¾Œã«ã‚·ãƒŠãƒªã‚ªDay 1ã®ãƒãƒ£ãƒƒãƒˆç”»é¢ã¸é·ç§»
  - _Requirements: 2.5_

---

- [ ] 4. AIãƒãƒ£ãƒƒãƒˆç”Ÿæˆï¼ˆã‚³ã‚¢æ©Ÿèƒ½ï¼‰

- [ ] 4.1 Gemini API çµ±åˆã¨ System Prompt æ§‹ç¯‰
  - `@google/generative-ai` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
  - ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å®šç¾©ãƒ»é›£æ˜“åº¦ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘¼ç§°ãƒ»æ™‚é–“å¸¯ã‚’çµ„ã¿åˆã‚ã›ãŸ System Prompt ã‚’å‹•çš„ã«ç”Ÿæˆã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…
  - ä¼šè©±å±¥æ­´ï¼ˆç›´è¿‘10å¾€å¾©ï¼‰ã‚’ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦ä»˜ä¸Žã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…
  - Gemini 1.5 Flash ãƒ¢ãƒ‡ãƒ«ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã€JSON ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ãƒ‘ãƒ¼ã‚¹ã™ã‚‹é–¢æ•°ã‚’å®Ÿè£…
  - API ã‚­ãƒ¼ãŒã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã«ã®ã¿å­˜åœ¨ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
  - _Requirements: 3.1, 3.5, 3.6_

- [ ] 4.2 ãƒãƒ£ãƒƒãƒˆç”Ÿæˆ Server Action ã®å®Ÿè£…
  - `generateReply(userText, conversationId)` Server Action ã‚’å®Ÿè£…
  - èªè¨¼ãƒã‚§ãƒƒã‚¯ â†’ ä½¿ç”¨é‡ãƒã‚§ãƒƒã‚¯ï¼ˆç„¡æ–™ãƒ¦ãƒ¼ã‚¶ãƒ¼3å¾€å¾©åˆ¶é™ï¼‰â†’ AIç”Ÿæˆ â†’ DBä¿å­˜ ã®ä¸€é€£ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè£…
  - åˆ¶é™è¶…éŽæ™‚ã« `{error: "LIMIT_EXCEEDED"}` ã‚’è¿”ã—ã€ãƒšã‚¤ã‚¦ã‚©ãƒ¼ãƒ«è¡¨ç¤ºã‚’ãƒˆãƒªã‚¬ãƒ¼
  - APIã‚¨ãƒ©ãƒ¼æ™‚ã®3å›žãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆexponential backoffï¼‰ã‚’å®Ÿè£…
  - Gemini ã®ä¸æ­£ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’å®Ÿè£…
  - _Requirements: 3.2, 3.4, 8.1_

- [ ] 4.3 (P) ãƒãƒ£ãƒƒãƒˆ UI ã®å®Ÿè£…
  - LINEé¢¨ãƒãƒ£ãƒƒãƒˆç”»é¢ã‚’ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã—ã¦å®Ÿè£…ï¼ˆåœ°ìš°ã®ã‚¢ã‚¤ã‚³ãƒ³ã€å¹ãå‡ºã—ã€ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ï¼‰
  - æ—¥æœ¬èªžå…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã¨ã€Œå¤‰æ›ã€ãƒœã‚¿ãƒ³ã‚’å®Ÿè£…
  - AIç”Ÿæˆä¸­ã®ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆãƒ‰ãƒƒãƒˆ3ç‚¹æ»…ï¼‰ã‚’å®Ÿè£…
  - ç”Ÿæˆçµæžœï¼ˆéŸ“å›½èªžè¿”ä¿¡ / ç†ç”± / ã‚¹ãƒ©ãƒ³ã‚°ï¼‰ã‚’3ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§è¡¨ç¤ºã™ã‚‹ãƒ‘ãƒãƒ«ã‚’å®Ÿè£…
  - ã€Œé€ä¿¡ã€ãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚ã«åœ°ìš°ã®æ¬¡ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè£…
  - _Requirements: 3.3, 3.7_

- [ ] 4.4 ä¼šè©±å±¥æ­´ã®ä¿å­˜ã¨èª­ã¿è¾¼ã¿
  - ãƒãƒ£ãƒƒãƒˆé€å—ä¿¡ã®ãŸã³ã« `conversations.messages` ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿½è¨˜
  - `usage_logs.turns_used` ã‚’ +1 ã™ã‚‹å‡¦ç†ã‚’å®Ÿè£…
  - `usage_logs.edit_count` / `retry_count` ã‚’è¨˜éŒ²ï¼ˆé›£æ˜“åº¦è¨ˆç®—ç”¨ï¼‰
  - å½“æ—¥ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒæ—¢å­˜ã®å ´åˆã€ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã‚’ç¶™ç¶šè¡¨ç¤ºã™ã‚‹
  - _Requirements: 3.5, 4.5, 5.5_

---

- [ ] 5. ã‚·ãƒŠãƒªã‚ªã‚·ã‚¹ãƒ†ãƒ 

- [ ] 5.1 ã‚·ãƒŠãƒªã‚ªãƒ‡ãƒ¼ã‚¿ã®æŠ•å…¥
  - Season 1 Week 1ï¼ˆ7ã‚·ãƒ¼ãƒ³ Ã— 4é›£æ˜“åº¦ Ã— 4æ™‚é–“å¸¯ï¼‰ã® `scenario_templates` ãƒ‡ãƒ¼ã‚¿ã‚’ SQL ã‚·ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä½œæˆ
  - å„ã‚·ãƒ¼ãƒ³ã« `scene_type`, `opening_message` JSON, `vocab_targets`, `next_message_hint` ã‚’è¨­å®š
  - Supabase Studio ã¾ãŸã¯ CLI ã§ã‚·ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚’æŠ•å…¥
  - _Requirements: 4.2, 4.4_

- [ ] 5.2 ä»Šæ—¥ã®ã‚·ãƒŠãƒªã‚ªé¸æŠžãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè£…
  - `getTodayScenario(userId, characterId)` é–¢æ•°ã‚’å®Ÿè£…
  - `user_scenario_progress` ã‹ã‚‰ã‚·ãƒ¼ã‚ºãƒ³/ã‚¦ã‚£ãƒ¼ã‚¯/ãƒ‡ã‚¤ã‚’èª­ã¿å–ã‚‹
  - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¬ãƒ™ãƒ« + ç¾åœ¨æ™‚åˆ»ã‹ã‚‰æœ€é©ãª `opening_message` ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é¸æŠž
  - å½“æ—¥ã‚»ãƒƒã‚·ãƒ§ãƒ³å­˜åœ¨ãƒã‚§ãƒƒã‚¯ã§äºŒé‡é€²è¡Œã‚’é˜²æ­¢
  - _Requirements: 4.1, 4.2, 4.4, 4.5_

- [ ] 5.3 ã‚·ãƒŠãƒªã‚ªé€²æ—ç®¡ç†ï¼ˆè‡ªå‹•é€²è¡Œï¼‰
  - 1æ—¥1å›žã®ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚ã« `advanceProgress()` ã‚’å‘¼ã³å‡ºã—ã€ç¿Œæ—¥ã®ã‚·ãƒ¼ãƒ³ã«é€²ã‚ã‚‹
  - `arc_day = 7` ã®ã‚·ãƒ¼ãƒ³ã‚’å®Œäº†ã—ãŸã¨ãã€`arc_week` ã‚’ +1ã€`arc_day` ã‚’ 1 ã«ãƒªã‚»ãƒƒãƒˆ
  - `arc_week = 4` å®Œäº†å¾Œã¯ `arc_season` ã‚’ +1 ã—ã¦æ¬¡ã®ã‚·ãƒ¼ã‚ºãƒ³ã«é€²ã‚€
  - _Requirements: 4.3_

- [ ] 5.4 Tensionã‚·ãƒ¼ãƒ³ã®2ãƒ•ã‚§ãƒ¼ã‚ºå®Ÿè£…
  - `scene_type = 'tension'` ã®ã‚·ãƒ¼ãƒ³ã§ã€æ‘©æ“¦ãƒ•ã‚§ãƒ¼ã‚º â†’ ä»²ç›´ã‚Šãƒ•ã‚§ãƒ¼ã‚ºã®2æ®µéšŽãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè£…
  - ä»²ç›´ã‚Šå®Œäº†æ™‚ã«ã€Œé–¢ä¿‚å€¤+1ã€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆFramer Motionï¼‰ã‚’è¡¨ç¤º
  - _Requirements: 4.6_

---

- [ ] 6. é›£æ˜“åº¦è‡ªå‹•å¤‰å‹•ã‚·ã‚¹ãƒ†ãƒ 

- [ ] 6.1 é›£æ˜“åº¦è¨ˆç®—ã‚¨ãƒ³ã‚¸ãƒ³ã®å®Ÿè£…
  - `calcNextLevel(currentLevel, metrics)` é–¢æ•°ã‚’å®Ÿè£…ï¼ˆ`noEditRate > 0.8` â†’ +1, `< 0.4` â†’ -1ï¼‰
  - 7æ—¥é–“ã® `usage_logs` ã‚’é›†è¨ˆã—ã¦ `DifficultyMetrics` ã‚’è¨ˆç®—ã™ã‚‹é–¢æ•°ã‚’å®Ÿè£…
  - `updateLevelIfNeeded(userId)` é–¢æ•°ã‚’å®Ÿè£…ã—ã€7æ—¥ã”ã¨ã«è‡ªå‹•å®Ÿè¡Œï¼ˆSupabase Edge Functions ã¾ãŸã¯ Next.js Cronï¼‰
  - _Requirements: 5.1, 5.2, 5.3_

- [ ] 6.2 AI ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¸ã®é›£æ˜“åº¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿çµ„ã¿è¾¼ã¿
  - `generateReply` å‘¼ã³å‡ºã—æ™‚ã« `users.current_level` ã‚’å–å¾—ã— System Prompt ã«æ¸¡ã™
  - ãƒ¬ãƒ™ãƒ«åˆ¥ã®å£èª¿ã‚¬ã‚¤ãƒ‰ï¼ˆLv1=çŸ­æ–‡ã€Lv2=ã‚¹ãƒ©ãƒ³ã‚°å…¥é–€ã€Lv3=è¤‡åˆè¡¨ç¾ã€Lv4=ãƒã‚¤ãƒ†ã‚£ãƒ–æ„Ÿæ€§ï¼‰ã‚’ System Prompt ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«çµ„ã¿è¾¼ã‚€
  - _Requirements: 5.4_

---

- [ ] 7. èªžå½™å¸³ãƒ»å­¦ç¿’è¨˜éŒ²

- [ ] 7.1 èªžå½™ã®è‡ªå‹•ä¿å­˜
  - AI è¿”ä¿¡ç”Ÿæˆå¾Œã€`slang` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å†…å®¹ã‚’ `vocabulary` ãƒ†ãƒ¼ãƒ–ãƒ«ã« upsert ã™ã‚‹
  - `why` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‹ã‚‰å­¦ç¿’è¡¨ç¾ã‚’æŠ½å‡ºã—ã¦èªžå½™å¸³ã«è¿½åŠ ã™ã‚‹
  - SRS ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆSM-2ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼‰ã§ `next_review` ã‚’è¨ˆç®—ã—ã¦ä¿å­˜
  - _Requirements: 6.1, 6.2, 6.4_

- [ ] 7.2 (P) èªžå½™å¸³ UI ã®å®Ÿè£…
  - èªžå½™å¸³ã‚¿ãƒ–ç”»é¢ã‚’å®Ÿè£…ï¼ˆæœ€è¿‘å­¦ã‚“ã é †ãƒªã‚¹ãƒˆï¼‰
  - å˜èªžãƒ»æ„å‘³ãƒ»ç¿’å¾—æ—¥ã‚’è¡¨ç¤ºã™ã‚‹èªžå½™ã‚«ãƒ¼ãƒ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆ
  - ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†å¾Œã®ã€Œä»Šæ—¥ +{n}è¡¨ç¾ã‚’ç¿’å¾—ã—ã¾ã—ãŸã€ã‚µãƒžãƒªãƒ¼ã‚«ãƒ¼ãƒ‰ã‚’ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãã§è¡¨ç¤º
  - _Requirements: 6.3, 6.5_

---

- [ ] 8. ã‚¹ãƒˆãƒªãƒ¼ã‚¯ãƒ»é€²æ—å¯è¦–åŒ–

- [ ] 8.1 ã‚¹ãƒˆãƒªãƒ¼ã‚¯ç®¡ç†ãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè£…
  - å½“æ—¥åˆå›žãƒãƒ£ãƒƒãƒˆé–‹å§‹æ™‚ã« `updateStreak(userId)` ã‚’å‘¼ã³å‡ºã™ Server Action ã‚’å®Ÿè£…
  - `last_active < today - 1` ã®å ´åˆã€`streak` ã‚’ 0 ã«ãƒªã‚»ãƒƒãƒˆã™ã‚‹æ¡ä»¶åˆ†å²ã‚’å®Ÿè£…
  - ãƒžã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ï¼ˆ7ãƒ»30ãƒ»100æ—¥ï¼‰åˆ°é”æ™‚ã«ç‰¹åˆ¥ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒˆãƒªã‚¬ãƒ¼ã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿”ã™
  - _Requirements: 7.1, 7.2, 7.4_

- [ ] 8.2 (P) é€²æ— UI ã®å®Ÿè£…
  - ãƒãƒ£ãƒƒãƒˆç”»é¢ä¸Šéƒ¨ã«ã€ŒðŸ”¥ Næ—¥é€£ç¶š / XPé€²æ—ãƒãƒ¼ã€å¸¸æ™‚è¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å®Ÿè£…
  - ãƒžã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³é”æˆæ™‚ã®ç´™å¹é›ªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ Framer Motion ã§å®Ÿè£…
  - ãƒ›ãƒ¼ãƒ ç”»é¢ã«ã€Œä»Šé€± +{n}è¡¨ç¾ / {n}æ—¥é€£ç¶šã€é€±æ¬¡ã‚µãƒžãƒªãƒ¼ã‚«ãƒ¼ãƒ‰ã‚’å®Ÿè£…
  - _Requirements: 7.3, 7.4, 7.5_

---

- [ ] 9. ãƒ•ãƒªãƒ¼ãƒŸã‚¢ãƒ èª²é‡‘ï¼ˆStripeï¼‰

- [ ] 9.1 Stripe é€£æºã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
  - Stripe ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã« Pro ãƒ—ãƒ©ãƒ³ï¼ˆÂ¥1,480/æœˆï¼‰ã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³å•†å“ã‚’ä½œæˆ
  - `stripe` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã€Stripe ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ Server-Only ã§åˆæœŸåŒ–
  - Stripe Webhook ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ Stripe Dashboard ã«ç™»éŒ²ã—ã€Webhook Secret ã‚’ç’°å¢ƒå¤‰æ•°ã«è¨­å®š
  - _Requirements: 8.3_

- [ ] 9.2 Checkout Session ã®ç”Ÿæˆã¨ãƒšã‚¤ã‚¦ã‚©ãƒ¼ãƒ« UI
  - `createCheckoutSession(userId)` Server Action ã‚’å®Ÿè£…ã— Stripe Checkout URL ã‚’è¿”ã™
  - ç„¡æ–™ä¸Šé™åˆ°é”æ™‚ã«ãƒšã‚¤ã‚¦ã‚©ãƒ¼ãƒ«ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤ºã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…
  - ãƒšã‚¤ã‚¦ã‚©ãƒ¼ãƒ«ã«ã€Œì§€ìš°ãŒã‚‚ã£ã¨è©±ã—ãŸãã†ã«ã—ã¦ã„ã¾ã™...ã€ã‚³ãƒ”ãƒ¼ã¨æ–™é‡‘è¡¨ç¤ºãƒ»ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã‚’é…ç½®
  - _Requirements: 8.1, 8.2, 8.3_

- [ ] 9.3 Stripe Webhook ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã®å®Ÿè£…
  - `POST /api/stripe/webhook` ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å®Ÿè£…
  - `stripe.webhooks.constructEvent()` ã§ç½²åæ¤œè¨¼ã‚’å¿…ãšå®Ÿæ–½
  - `checkout.session.completed` ã§ `users.plan = 'pro'` ã«æ›´æ–°
  - `customer.subscription.deleted` ã§ `users.plan = 'free'` ã«æˆ»ã™
  - Stripe ã‚¤ãƒ™ãƒ³ãƒˆ ID ã‚’ idempotency ã‚­ãƒ¼ã¨ã—ã¦é‡è¤‡å‡¦ç†ã‚’é˜²æ­¢
  - _Requirements: 8.4, 8.5, 8.6_

---

- [ ] 10. Web Push é€šçŸ¥

- [ ] 10.1 Web Push ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ç®¡ç†
  - åˆå›žã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚ã«ãƒ–ãƒ©ã‚¦ã‚¶ã®é€šçŸ¥è¨±å¯ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤º
  - è¨±å¯ã•ã‚ŒãŸå ´åˆã« `PushSubscription` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ `push_subscriptions` ãƒ†ãƒ¼ãƒ–ãƒ«ã«ä¿å­˜ã™ã‚‹ Server Action ã‚’å®Ÿè£…
  - é€šçŸ¥è¨­å®šã®ã‚ªãƒ³/ã‚ªãƒ•åˆ‡ã‚Šæ›¿ãˆã‚’è¨­å®šç”»é¢ã«å®Ÿè£…
  - _Requirements: 9.1, 9.2, 9.5_

- [ ] 10.2 ãƒ‡ã‚¤ãƒªãƒ¼ãƒªãƒžã‚¤ãƒ³ãƒ€ãƒ¼é€ä¿¡
  - å‰æ—¥ã‚¢ã‚¯ã‚»ã‚¹ã‚ã‚Šãƒ»å½“æ—¥æœªã‚¢ã‚¯ã‚»ã‚¹ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ¯Žæ—¥ 9:00 JST ã«æŠ½å‡ºã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã‚’ Supabase Edge Functionsï¼ˆcronï¼‰ã§å®Ÿè£…
  - Web Push API ã§ã€Œì§€ìš°ã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå±Šã„ã¦ã„ã¾ã™ ðŸ¥ºã€é€šçŸ¥ã‚’é€ä¿¡
  - é€šçŸ¥ã‚¯ãƒªãƒƒã‚¯æ™‚ã«å½“æ—¥ãƒãƒ£ãƒƒãƒˆç”»é¢ã¸é·ç§»ã•ã›ã‚‹ `data.url` ã‚’è¨­å®š
  - 1æ—¥1å›žåˆ¶é™ã‚’è¨­ã‘ã¦é€ä¿¡æ¸ˆã¿ãƒ•ãƒ©ã‚°ã‚’ç®¡ç†
  - _Requirements: 9.3, 9.4, 9.5_

---

- [ ] 11. ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–

- [ ] 11.1 API ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®å®Ÿè£…
  - Server Actions ã®èªè¨¼æ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯ã‚’å…±é€šãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã¨ã—ã¦å®Ÿè£…
  - `usage_logs` ã‚’ä½¿ã„ 1ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚ãŸã‚Š 1åˆ†10ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¶…ãˆãŸå ´åˆã« 429 ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™
  - æœªèªè¨¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã™ã¹ã¦ 401 ã§æ‹’å¦ã™ã‚‹
  - _Requirements: 10.2, 10.3_

- [ ] 11.2 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹æœ€é©åŒ–
  - Gemini API ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ Server Actions ã® Streaming Response ã§æ®µéšŽçš„ã«è¿”ã™å®Ÿè£…ã‚’æ¤œè¨Žãƒ»é©ç”¨
  - Next.js Image Optimization ã§åœ°ìš°ã®ã‚¢ãƒã‚¿ãƒ¼ç”»åƒã‚’æœ€é©åŒ–
  - `conversations` ãƒ†ãƒ¼ãƒ–ãƒ«ã« `(user_id, date)` è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
  - Vercel Analytics ã‚’æœ‰åŠ¹åŒ–ã— LCP ã‚’è¨ˆæ¸¬
  - _Requirements: 10.4, 10.5_

---

- [ ] 12. ãƒ†ã‚¹ãƒˆå®Ÿè£…

- [ ] 12.1 ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
  - `DifficultyEngine.calcNextLevel()` ã®ãƒœãƒ¼ãƒ€ãƒ¼å€¤ãƒ†ã‚¹ãƒˆï¼ˆnoEditRate 0.8/0.4, avgRetries 0.5/2ï¼‰
  - `VocabularyService` SRS ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¨ˆç®—ã®ãƒ†ã‚¹ãƒˆï¼ˆSM-2 å„ãƒ•ã‚§ãƒ¼ã‚ºï¼‰
  - `StreakService.updateStreak()` ã®ç¶™ç¶š/æ–­çµ¶ä¸¡ã‚±ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆ
  - _Requirements: 5.2, 5.3, 6.4, 7.1, 7.2_

- [ ] 12.2 çµ±åˆãƒ†ã‚¹ãƒˆ
  - `generateReply` Server Action â€” Gemini API ãƒ¢ãƒƒã‚¯ã§å…¨ãƒ•ãƒ­ãƒ¼ï¼ˆèªè¨¼ãƒ»åˆ¶é™ãƒã‚§ãƒƒã‚¯ãƒ»ç”Ÿæˆãƒ»ä¿å­˜ï¼‰ãƒ†ã‚¹ãƒˆ
  - Stripe Webhook Handler â€” `checkout.session.completed` ã‚¤ãƒ™ãƒ³ãƒˆã§ `plan=pro` ã«ãªã‚‹ãƒ†ã‚¹ãƒˆ
  - ã‚·ãƒŠãƒªã‚ªé€²æ— â€” `arc_day=7` å®Œäº†æ™‚ã« `arc_week+1` + `arc_day=1` ã«ãªã‚‹ãƒ†ã‚¹ãƒˆ
  - _Requirements: 3.1, 3.4, 4.3, 8.4_

- [ ] 12.3 E2E ãƒ†ã‚¹ãƒˆï¼ˆPlaywrightï¼‰
  - ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚° â†’ ãƒ‡ãƒ¢ä½“é¨“ â†’ ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ— â†’ åˆå›žãƒãƒ£ãƒƒãƒˆ ã®å®Œå…¨ãƒ•ãƒ­ãƒ¼
  - ç„¡æ–™ä¸Šé™ï¼ˆ3å¾€å¾©ï¼‰åˆ°é” â†’ ãƒšã‚¤ã‚¦ã‚©ãƒ¼ãƒ«ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º ã®ç¢ºèª
  - ã‚¹ãƒˆãƒªãƒ¼ã‚¯æ›´æ–° â†’ UIåæ˜  ã®ç¢ºèª
  - _Requirements: 2.1, 2.2, 2.3, 8.1, 8.2, 7.1, 7.3_

---

## è¦ä»¶ã‚«ãƒãƒ¬ãƒƒã‚¸ç¢ºèª

| è¦ä»¶ã‚°ãƒ«ãƒ¼ãƒ— | ã‚«ãƒãƒ¼ã™ã‚‹ã‚¿ã‚¹ã‚¯ |
|------------|----------------|
| 1 (èªè¨¼) | 2.1, 2.2, 2.3 |
| 2 (ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°) | 3.1, 3.2, 3.3 |
| 3 (AIãƒãƒ£ãƒƒãƒˆ) | 4.1, 4.2, 4.3, 4.4 |
| 4 (ã‚·ãƒŠãƒªã‚ª) | 5.1, 5.2, 5.3, 5.4 |
| 5 (é›£æ˜“åº¦) | 6.1, 6.2 |
| 6 (èªžå½™å¸³) | 7.1, 7.2 |
| 7 (ã‚¹ãƒˆãƒªãƒ¼ã‚¯) | 8.1, 8.2 |
| 8 (èª²é‡‘) | 9.1, 9.2, 9.3 |
| 9 (é€šçŸ¥) | 10.1, 10.2 |
| 10 (ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£) | 1.2, 2.3, 11.1, 11.2 |
