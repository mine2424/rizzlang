# Implementation Tasks â€” RizzLang MVP

## ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å‡¡ä¾‹
- [x] å®Œäº†
- [ ] æœªç€æ‰‹
- (P) ä»–ã‚¿ã‚¹ã‚¯ã¨ä¸¦åˆ—å®Ÿè¡Œå¯èƒ½

---

## ã‚¿ã‚¹ã‚¯ä¸€è¦§

---

- [x] 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŸºç›¤ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

- [x] 1.1 Flutter ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆæœŸåŒ–
  - `flutter create rizzlang --org com.rizzlang` ã§ iOS / Android å¯¾å¿œãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
  - `pubspec.yaml` ã«å…¨ä¾å­˜é–¢ä¿‚è¿½åŠ ï¼ˆsupabase_flutter, riverpod, go_router, google_sign_in, sign_in_with_apple, flutter_stripe, firebase_messaging, flutter_animate, freezed, json_serializable ç­‰ï¼‰
  - Material 3 ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒž + ãƒ”ãƒ³ã‚¯ãƒ—ãƒ©ã‚¤ãƒžãƒªã‚’ `app_theme.dart` ã§å®šç¾©
  - GitHub ãƒªãƒã‚¸ãƒˆãƒªä½œæˆ â†’ `main` ãƒ–ãƒ©ãƒ³ãƒã¸ã® push å®Œäº†
  - _Requirements: 10.1_

- [x] 1.2 (P) Supabase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã¨ã‚¹ã‚­ãƒ¼ãƒžå®šç¾©
  - `supabase/migrations/20260226_init.sql` ã«å…¨ãƒ†ãƒ¼ãƒ–ãƒ« DDL ä½œæˆæ¸ˆã¿
  - `users`, `characters`, `conversations`, `scenario_templates`, `user_scenario_progress`, `vocabulary`, `usage_logs`, `fcm_tokens` ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©
  - å…¨ãƒ†ãƒ¼ãƒ–ãƒ«ã« RLS æœ‰åŠ¹åŒ– + `auth.uid() = user_id` ãƒãƒªã‚·ãƒ¼è¨­å®š
  - è¤‡åˆãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„ãƒ»ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨­å®šæ¸ˆã¿
  - âš ï¸ æ®‹ä½œæ¥­: Supabase CLI ã§å®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é©ç”¨
  - _Requirements: 1.5, 10.1, 10.2_

- [x] 1.3 (P) ç’°å¢ƒå¤‰æ•°ã¨åž‹å®šç¾©ã®æ•´å‚™
  - `lib/core/services/env.dart` ã«ç’°å¢ƒå¤‰æ•°ãƒ­ãƒ¼ãƒ€ãƒ¼ï¼ˆ`--dart-define` å¯¾å¿œï¼‰ä½œæˆ
  - `lib/core/models/` ã« Freezed ãƒ¢ãƒ‡ãƒ«ä½œæˆæ¸ˆã¿ï¼ˆUserModel, MessageModel, ScenarioModel, VocabularyModelï¼‰
  - `lib/core/services/ai_service.dart` ã« Supabase Edge Functions ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå®Ÿè£…æ¸ˆã¿
  - _Requirements: 10.1_

---

- [x] 2. èªè¨¼ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†

- [x] 2.1 Google / Apple OAuth ãƒ­ã‚°ã‚¤ãƒ³å®Ÿè£…
  - `lib/features/auth/screens/login_screen.dart` ä½œæˆæ¸ˆã¿
  - `lib/core/providers/auth_provider.dart` ã§ Riverpod Ã— Supabase Auth é€£æº
  - Google Sign-In + Apple Sign-In ãƒœã‚¿ãƒ³å®Ÿè£…æ¸ˆã¿
  - GoRouter ã® `redirect` ã§æœªèªè¨¼æ™‚ã«ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã¸è‡ªå‹•é·ç§»
  - _Requirements: 1.1, 1.2_

- [ ] 2.2 åˆå›žãƒ­ã‚°ã‚¤ãƒ³æ™‚ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆ
  - Supabase Auth ã® `auth.users` ã«å¯¾ã—ã¦ `users` ãƒ†ãƒ¼ãƒ–ãƒ«ã¸ã®è‡ªå‹•æŒ¿å…¥ãƒˆãƒªã‚¬ãƒ¼ã‚’è¨­å®šï¼ˆDatabase Functionï¼‰
  - åˆå›žãƒ­ã‚°ã‚¤ãƒ³æ™‚ã« `plan=free`, `streak=0`, `current_level=1` ã§åˆæœŸåŒ–
  - `user_scenario_progress` ã«åœ°ìš°ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®åˆæœŸé€²æ—ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆ
  - _Requirements: 1.3_

- [x] 2.3 ã‚»ãƒƒã‚·ãƒ§ãƒ³è‡ªå‹•æ›´æ–°ã¨ãƒ«ãƒ¼ãƒˆä¿è­·
  - GoRouter ã® `redirect` ã§èªè¨¼çŠ¶æ…‹ã‚’ç›£è¦–ã—ã¦ãƒ«ãƒ¼ãƒˆä¿è­·å®Ÿè£…æ¸ˆã¿
  - `supabase_flutter` ã®ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³è‡ªå‹•æ›´æ–°ãŒæ©Ÿèƒ½ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
  - Edge Functions ã§ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã”ã¨ã« JWT æ¤œè¨¼å®Ÿè£…æ¸ˆã¿
  - _Requirements: 1.4, 10.2_

---

- [x] 3. ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ•ãƒ­ãƒ¼

- [x] 3.1 ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ã‚¹ã‚¿ãƒ–
  - `lib/features/auth/screens/onboarding_screen.dart` ä½œæˆæ¸ˆã¿ï¼ˆã‚¹ã‚¿ãƒ–ï¼‰
  - âš ï¸ æ®‹ä½œæ¥­: ãƒ‡ãƒ¢ãƒãƒ£ãƒƒãƒˆä½“é¨“ãƒ•ãƒ­ãƒ¼ãƒ»generate-demo-reply å‘¼ã³å‡ºã—ã®å®Ÿè£…
  - _Requirements: 2.1, 2.2, 2.3_

- [ ] 3.2 ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘¼ç§°ã®é¸æŠž
  - ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã®é€”ä¸­ã§ã€Œì§€ìš°ã‹ã‚‰ã©ã†å‘¼ã°ã‚ŒãŸã„ã§ã™ã‹ï¼Ÿã€é¸æŠžç”»é¢ã‚’è¡¨ç¤º
  - ã€Œã‚ªãƒƒãƒ‘ / ìžê¸°ì•¼ / ã‚«ã‚¹ã‚¿ãƒ å…¥åŠ›ã€ã®3æŠžã‚’æä¾›
  - é¸æŠžã—ãŸå‘¼ç§°ã‚’ `users.user_call_name` ã«ä¿å­˜
  - _Requirements: 2.4_

- [ ] 3.3 ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å®Œäº†å¾Œã®åˆæœŸã‚·ãƒ¼ãƒ³é–‹å§‹
  - ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å®Œäº†æ™‚ã« `user_scenario_progress` ã‚’ season=1, week=1, day=1 ã«è¨­å®š
  - å®Œäº†ç›´å¾Œã«ã‚·ãƒŠãƒªã‚ª Day 1 ã®ãƒãƒ£ãƒƒãƒˆç”»é¢ã¸é·ç§»
  - _Requirements: 2.5_

---

- [x] 4. AIãƒãƒ£ãƒƒãƒˆç”Ÿæˆï¼ˆã‚³ã‚¢æ©Ÿèƒ½ï¼‰

- [x] 4.1 Gemini API çµ±åˆã¨ System Prompt æ§‹ç¯‰ï¼ˆEdge Functionï¼‰
  - `supabase/functions/generate-reply/index.ts` å®Ÿè£…æ¸ˆã¿
  - ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å®šç¾©ãƒ»é›£æ˜“åº¦ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘¼ç§°ãƒ»æ™‚é–“å¸¯ã‚’çµ„ã¿åˆã‚ã›ãŸ System Prompt å‹•çš„ç”Ÿæˆ
  - ä¼šè©±å±¥æ­´ï¼ˆç›´è¿‘10å¾€å¾©ï¼‰ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆä»˜ä¸Ž
  - Gemini 1.5 Flash ãƒ¢ãƒ‡ãƒ«ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ + JSON ãƒ‘ãƒ¼ã‚¹å®Ÿè£…æ¸ˆã¿
  - API ã‚­ãƒ¼ã¯ Edge Function ã® Secrets ã®ã¿
  - _Requirements: 3.1, 3.5, 3.6_

- [x] 4.2 ãƒãƒ£ãƒƒãƒˆç”Ÿæˆ Edge Function ã®å®Ÿè£…
  - `generate-reply`: èªè¨¼ãƒã‚§ãƒƒã‚¯ â†’ ä½¿ç”¨é‡ãƒã‚§ãƒƒã‚¯ï¼ˆç„¡æ–™3å¾€å¾©åˆ¶é™ï¼‰â†’ AIç”Ÿæˆ â†’ DBä¿å­˜ å®Ÿè£…æ¸ˆã¿
  - åˆ¶é™è¶…éŽæ™‚ã« `{error: "LIMIT_EXCEEDED"}` è¿”å´
  - èªè¨¼ãªã—ãƒ‡ãƒ¢ç”¨ `generate-demo-reply` å®Ÿè£…æ¸ˆã¿
  - _Requirements: 3.2, 3.4, 8.1_

- [x] 4.3 (P) ãƒãƒ£ãƒƒãƒˆ UI ã®å®Ÿè£…
  - `lib/features/chat/screens/chat_screen.dart` â€” ãƒ¡ã‚¤ãƒ³ãƒãƒ£ãƒƒãƒˆç”»é¢å®Ÿè£…æ¸ˆã¿
  - `lib/features/chat/widgets/message_bubble.dart` â€” LINEé¢¨å¹ãå‡ºã—å®Ÿè£…æ¸ˆã¿
  - `lib/features/chat/widgets/reply_panel.dart` â€” è§£èª¬ãƒ»ã‚¹ãƒ©ãƒ³ã‚°ãƒ‘ãƒãƒ«å®Ÿè£…æ¸ˆã¿
  - `lib/features/chat/widgets/streak_bar.dart` â€” ã‚¹ãƒˆãƒªãƒ¼ã‚¯è¡¨ç¤ºãƒãƒ¼å®Ÿè£…æ¸ˆã¿
  - `lib/features/chat/providers/chat_provider.dart` â€” Riverpod çŠ¶æ…‹ç®¡ç†å®Ÿè£…æ¸ˆã¿
  - _Requirements: 3.3, 3.7_

- [ ] 4.4 ä¼šè©±å±¥æ­´ã®ä¿å­˜ã¨èª­ã¿è¾¼ã¿ï¼ˆè©³ç´°å®Ÿè£…ï¼‰
  - ãƒãƒ£ãƒƒãƒˆé€å—ä¿¡ã®ãŸã³ã« `conversations.messages` ã¸ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¿½è¨˜ç¢ºèª
  - `usage_logs.turns_used` +1 å‡¦ç†ã®ç¢ºèª
  - `usage_logs.edit_count` / `retry_count` è¨˜éŒ²ï¼ˆé›£æ˜“åº¦è¨ˆç®—ç”¨ï¼‰
  - å½“æ—¥ã‚»ãƒƒã‚·ãƒ§ãƒ³æ—¢å­˜æ™‚ã®ãƒãƒ£ãƒƒãƒˆå±¥æ­´ç¶™ç¶šè¡¨ç¤ºç¢ºèª
  - _Requirements: 3.5, 4.5, 5.5_

---

- [ ] 5. ã‚·ãƒŠãƒªã‚ªã‚·ã‚¹ãƒ†ãƒ 

- [ ] 5.1 ã‚·ãƒŠãƒªã‚ªãƒ‡ãƒ¼ã‚¿ã®æŠ•å…¥
  - Season 1 Week 1ï¼ˆ7ã‚·ãƒ¼ãƒ³ Ã— 4é›£æ˜“åº¦ Ã— 4æ™‚é–“å¸¯ï¼‰ã® `scenario_templates` ãƒ‡ãƒ¼ã‚¿ã‚’ SQL ã‚·ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä½œæˆ
  - `SCENARIO_DESIGN.md` ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å‚ç…§ã—ã¦å„ã‚·ãƒ¼ãƒ³ã« `scene_type`, `opening_message` JSON, `vocab_targets`, `next_message_hint` ã‚’è¨­å®š
  - Supabase CLI ã§ã‚·ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚’æŠ•å…¥
  - _Requirements: 4.2, 4.4_

- [ ] 5.2 ä»Šæ—¥ã®ã‚·ãƒŠãƒªã‚ªé¸æŠžãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè£…
  - `getTodayScenario(userId, characterId)` é–¢æ•°ã‚’å®Ÿè£…ï¼ˆEdge Function å†…ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼‰
  - `user_scenario_progress` ã‹ã‚‰ã‚·ãƒ¼ã‚ºãƒ³/ã‚¦ã‚£ãƒ¼ã‚¯/ãƒ‡ã‚¤ã‚’èª­ã¿å–ã‚‹
  - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¬ãƒ™ãƒ« + ãƒ‡ãƒã‚¤ã‚¹æ™‚åˆ»ã‹ã‚‰æœ€é©ãª `opening_message` ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é¸æŠž
  - å½“æ—¥ã‚»ãƒƒã‚·ãƒ§ãƒ³å­˜åœ¨ãƒã‚§ãƒƒã‚¯ã§äºŒé‡é€²è¡Œã‚’é˜²æ­¢
  - _Requirements: 4.1, 4.2, 4.4, 4.5_

- [ ] 5.3 ã‚·ãƒŠãƒªã‚ªé€²æ—ç®¡ç†ï¼ˆè‡ªå‹•é€²è¡Œï¼‰
  - 1æ—¥1å›žã®ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚ã« `advanceProgress()` ã‚’å‘¼ã³å‡ºã—ã€ç¿Œæ—¥ã®ã‚·ãƒ¼ãƒ³ã«é€²ã‚ã‚‹
  - `arc_day = 7` ã®ã‚·ãƒ¼ãƒ³ã‚’å®Œäº†ã—ãŸã¨ãã€`arc_week` ã‚’ +1ã€`arc_day` ã‚’ 1 ã«ãƒªã‚»ãƒƒãƒˆ
  - `arc_week = 4` å®Œäº†å¾Œã¯ `arc_season` ã‚’ +1 ã—ã¦æ¬¡ã®ã‚·ãƒ¼ã‚ºãƒ³ã«é€²ã‚€
  - _Requirements: 4.3_

- [ ] 5.4 Tensionã‚·ãƒ¼ãƒ³ã®2ãƒ•ã‚§ãƒ¼ã‚ºå®Ÿè£…
  - `scene_type = 'tension'` ã®ã‚·ãƒ¼ãƒ³ã§ã€æ‘©æ“¦ãƒ•ã‚§ãƒ¼ã‚º â†’ ä»²ç›´ã‚Šãƒ•ã‚§ãƒ¼ã‚ºã®2æ®µéšŽãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè£…
  - ä»²ç›´ã‚Šå®Œäº†æ™‚ã«ã€Œé–¢ä¿‚å€¤+1ã€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆflutter_animateï¼‰ã‚’è¡¨ç¤º
  - _Requirements: 4.6_

---

- [ ] 6. é›£æ˜“åº¦è‡ªå‹•å¤‰å‹•ã‚·ã‚¹ãƒ†ãƒ 

- [ ] 6.1 é›£æ˜“åº¦è¨ˆç®—ã‚¨ãƒ³ã‚¸ãƒ³ã®å®Ÿè£…
  - `calcNextLevel(currentLevel, metrics)` é–¢æ•°ã‚’å®Ÿè£…ï¼ˆ`noEditRate > 0.8` â†’ +1, `< 0.4` â†’ -1ï¼‰
  - 7æ—¥é–“ã® `usage_logs` ã‚’é›†è¨ˆã—ã¦ `DifficultyMetrics` ã‚’è¨ˆç®—ã™ã‚‹é–¢æ•°ã‚’å®Ÿè£…
  - `supabase/functions/difficulty-updater/index.ts` ã‚’å®Ÿè£…ã— Supabase Cron ã§7æ—¥ã”ã¨ã«è‡ªå‹•å®Ÿè¡Œ
  - _Requirements: 5.1, 5.2, 5.3_

- [ ] 6.2 AI ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¸ã®é›£æ˜“åº¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿çµ„ã¿è¾¼ã¿
  - `generate-reply` å‘¼ã³å‡ºã—æ™‚ã« `users.current_level` ã‚’å–å¾—ã— System Prompt ã«æ¸¡ã™ï¼ˆå®Ÿè£…æ¸ˆã¿ã®ãƒ­ã‚¸ãƒƒã‚¯ç¢ºèªï¼‰
  - ãƒ¬ãƒ™ãƒ«åˆ¥ã®å£èª¿ã‚¬ã‚¤ãƒ‰ï¼ˆLv1=çŸ­æ–‡ã€Lv2=ã‚¹ãƒ©ãƒ³ã‚°å…¥é–€ã€Lv3=è¤‡åˆè¡¨ç¾ã€Lv4=ãƒã‚¤ãƒ†ã‚£ãƒ–æ„Ÿæ€§ï¼‰ãŒ System Prompt ã«çµ„ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
  - _Requirements: 5.4_

---

- [ ] 7. èªžå½™å¸³ãƒ»å­¦ç¿’è¨˜éŒ²

- [ ] 7.1 èªžå½™ã®è‡ªå‹•ä¿å­˜
  - AI è¿”ä¿¡ç”Ÿæˆå¾Œã€`slang` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å†…å®¹ã‚’ Edge Function ã‹ã‚‰ `vocabulary` ãƒ†ãƒ¼ãƒ–ãƒ«ã« upsert ã™ã‚‹ï¼ˆ`generate-reply` å†…ã§ç¢ºèªãƒ»è£œå¼·ï¼‰
  - SRS ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆSM-2ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼‰ã§ `next_review` ã‚’è¨ˆç®—ã—ã¦ä¿å­˜
  - _Requirements: 6.1, 6.2, 6.4_

- [x] 7.2 (P) èªžå½™å¸³ UI ã‚¹ã‚¿ãƒ–
  - `lib/features/vocabulary/screens/vocabulary_screen.dart` ä½œæˆæ¸ˆã¿ï¼ˆã‚¹ã‚¿ãƒ–ï¼‰
  - âš ï¸ æ®‹ä½œæ¥­: Supabase ã‹ã‚‰èªžå½™ä¸€è¦§å–å¾—ãƒ»ãƒªã‚¹ãƒˆè¡¨ç¤ºãƒ»SRSå¾©ç¿’UI ã®å®Ÿè£…
  - _Requirements: 6.3, 6.5_

---

- [ ] 8. ã‚¹ãƒˆãƒªãƒ¼ã‚¯ãƒ»é€²æ—å¯è¦–åŒ–

- [ ] 8.1 ã‚¹ãƒˆãƒªãƒ¼ã‚¯ç®¡ç†ãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè£…
  - å½“æ—¥åˆå›žãƒãƒ£ãƒƒãƒˆé–‹å§‹æ™‚ã« `updateStreak(userId)` ã‚’ Supabase çµŒç”±ã§å‘¼ã³å‡ºã™å‡¦ç†ã‚’å®Ÿè£…
  - `last_active < today - 1` ã®å ´åˆã€`streak` ã‚’ 0 ã«ãƒªã‚»ãƒƒãƒˆã™ã‚‹æ¡ä»¶åˆ†å²ã‚’å®Ÿè£…
  - ãƒžã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ï¼ˆ7ãƒ»30ãƒ»100æ—¥ï¼‰åˆ°é”æ™‚ã«ç‰¹åˆ¥ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒˆãƒªã‚¬ãƒ¼ã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿”ã™
  - _Requirements: 7.1, 7.2, 7.4_

- [x] 8.2 (P) é€²æ— UI ã®å®Ÿè£…
  - `lib/features/chat/widgets/streak_bar.dart` â€” ã‚¹ãƒˆãƒªãƒ¼ã‚¯è¡¨ç¤ºãƒãƒ¼å®Ÿè£…æ¸ˆã¿
  - âš ï¸ æ®‹ä½œæ¥­: ãƒžã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³é”æˆæ™‚ã®ç´™å¹é›ªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆflutter_animateï¼‰
  - âš ï¸ æ®‹ä½œæ¥­: ãƒ›ãƒ¼ãƒ ç”»é¢ã®ã€Œä»Šé€± +{n}è¡¨ç¾ / {n}æ—¥é€£ç¶šã€é€±æ¬¡ã‚µãƒžãƒªãƒ¼ã‚«ãƒ¼ãƒ‰
  - _Requirements: 7.3, 7.4, 7.5_

---

- [ ] 9. ãƒ•ãƒªãƒ¼ãƒŸã‚¢ãƒ èª²é‡‘ï¼ˆStripeï¼‰

- [ ] 9.1 Stripe é€£æºã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
  - Stripe ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã« Pro ãƒ—ãƒ©ãƒ³ï¼ˆÂ¥1,480/æœˆï¼‰ã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³å•†å“ã‚’ä½œæˆ
  - `flutter_stripe` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®åˆæœŸåŒ–ï¼ˆiOS: `AppDelegate` è¨­å®šã€Android: `build.gradle` è¨­å®šï¼‰
  - Stripe Webhook ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆ`/functions/v1/stripe-webhook`ï¼‰ã‚’ Stripe Dashboard ã«ç™»éŒ²
  - Webhook Secret ã‚’ Supabase Edge Function ã® Secrets ã«è¨­å®š
  - _Requirements: 8.3_

- [ ] 9.2 Checkout Session ã®ç”Ÿæˆã¨ãƒšã‚¤ã‚¦ã‚©ãƒ¼ãƒ« UI
  - `supabase/functions/create-checkout/index.ts` ã‚’å®Ÿè£…ã— Stripe Checkout URL ã‚’è¿”ã™
  - ç„¡æ–™ä¸Šé™åˆ°é”æ™‚ã«ãƒšã‚¤ã‚¦ã‚©ãƒ¼ãƒ« BottomSheet ã‚’è¡¨ç¤ºã™ã‚‹ Flutter UI ã‚’å®Ÿè£…
  - ãƒšã‚¤ã‚¦ã‚©ãƒ¼ãƒ«ã«ã€Œì§€ìš°ãŒã‚‚ã£ã¨è©±ã—ãŸãã†ã«ã—ã¦ã„ã¾ã™...ã€ã‚³ãƒ”ãƒ¼ã¨æ–™é‡‘è¡¨ç¤ºãƒ»ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã‚’é…ç½®
  - _Requirements: 8.1, 8.2, 8.3_

- [ ] 9.3 Stripe Webhook ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã®å®Ÿè£…
  - `supabase/functions/stripe-webhook/index.ts` ã‚’å®Ÿè£…
  - `stripe.webhooks.constructEvent()` ã§ç½²åæ¤œè¨¼ã‚’å¿…ãšå®Ÿæ–½
  - `checkout.session.completed` ã§ `users.plan = 'pro'` ã«æ›´æ–°
  - `customer.subscription.deleted` ã§ `users.plan = 'free'` ã«æˆ»ã™
  - Stripe ã‚¤ãƒ™ãƒ³ãƒˆ ID ã‚’ idempotency ã‚­ãƒ¼ã¨ã—ã¦é‡è¤‡å‡¦ç†ã‚’é˜²æ­¢
  - _Requirements: 8.4, 8.5, 8.6_

---

- [ ] 10. FCM Push é€šçŸ¥

- [ ] 10.1 FCM ãƒ‡ãƒã‚¤ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†
  - `firebase_messaging` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®åˆæœŸåŒ–ï¼ˆiOS: APNs è¨­å®šã€Android: `google-services.json`ï¼‰
  - åˆå›žèµ·å‹•æ™‚ã« FCM ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã— `fcm_tokens` ãƒ†ãƒ¼ãƒ–ãƒ«ã«ä¿å­˜ã™ã‚‹å‡¦ç†ã‚’å®Ÿè£…
  - é€šçŸ¥è¨­å®šã®ã‚ªãƒ³/ã‚ªãƒ•åˆ‡ã‚Šæ›¿ãˆã‚’è¨­å®šç”»é¢ã«å®Ÿè£…
  - _Requirements: 9.1, 9.2, 9.5_

- [ ] 10.2 ãƒ‡ã‚¤ãƒªãƒ¼ãƒªãƒžã‚¤ãƒ³ãƒ€ãƒ¼é€ä¿¡
  - `supabase/functions/fcm-scheduler/index.ts` ã‚’å®Ÿè£…ï¼ˆSupabase Cronã€æ¯Žæ—¥ 9:00 JSTï¼‰
  - å‰æ—¥ã‚¢ã‚¯ã‚»ã‚¹ã‚ã‚Šãƒ»å½“æ—¥æœªã‚¢ã‚¯ã‚»ã‚¹ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æŠ½å‡º
  - FCM API ã§ã€Œì§€ìš°ã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå±Šã„ã¦ã„ã¾ã™ ðŸ¥ºã€é€šçŸ¥ã‚’é€ä¿¡
  - é€šçŸ¥ã‚¿ãƒƒãƒ—æ™‚ã«å½“æ—¥ãƒãƒ£ãƒƒãƒˆç”»é¢ã¸é·ç§»ï¼ˆ`notification.click_action` è¨­å®šï¼‰
  - 1æ—¥1å›žåˆ¶é™ã§é€ä¿¡æ¸ˆã¿ãƒ•ãƒ©ã‚°ã‚’ç®¡ç†
  - _Requirements: 9.3, 9.4, 9.5_

---

- [x] 11. è¨­å®šãƒ»ãƒ›ãƒ¼ãƒ ç”»é¢ã‚¹ã‚¿ãƒ–

- [x] 11.1 ãƒ›ãƒ¼ãƒ ç”»é¢ãƒ»è¨­å®šç”»é¢ã‚¹ã‚¿ãƒ–
  - `lib/features/home/home_screen.dart` â€” BottomNavigationBar ä»˜ãã‚·ã‚§ãƒ«å®Ÿè£…æ¸ˆã¿
  - `lib/features/settings/settings_screen.dart` â€” è¨­å®šç”»é¢ã‚¹ã‚¿ãƒ–å®Ÿè£…æ¸ˆã¿
  - âš ï¸ æ®‹ä½œæ¥­: è¨­å®šç”»é¢ã¸ã®é€šçŸ¥ON/OFFãƒ»å‘¼ç§°å¤‰æ›´ãƒ»Proã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯å®Ÿè£…

---

- [ ] 12. ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–

- [ ] 12.1 API ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®å®Ÿè£…
  - Edge Functions ã®èªè¨¼æ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯ã‚’å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ã¨ã—ã¦å®Ÿè£…
  - `usage_logs` ã‚’ä½¿ã„ 1ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚ãŸã‚Š 1åˆ†10ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¶…ãˆãŸå ´åˆã« 429 ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™
  - æœªèªè¨¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã™ã¹ã¦ 401 ã§æ‹’å¦ã™ã‚‹
  - _Requirements: 10.2, 10.3_

- [ ] 12.2 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹æœ€é©åŒ–
  - Gemini API ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ Flutter å´ã§ã‚¹ã‚±ãƒ«ãƒˆãƒ³ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
  - `conversations` ãƒ†ãƒ¼ãƒ–ãƒ«ã® `(user_id, date)` è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
  - Firebase Performance Monitoring ã§ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨ˆæ¸¬ã‚’æœ‰åŠ¹åŒ–
  - `flutter build appbundle --release --obfuscate` ã§ãƒªãƒªãƒ¼ã‚¹ãƒ“ãƒ«ãƒ‰ç¢ºèª
  - _Requirements: 10.4, 10.5_

---

- [ ] 13. ãƒ†ã‚¹ãƒˆå®Ÿè£…

- [ ] 13.1 ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆ`flutter_test`ï¼‰
  - `DifficultyEngine.calcNextLevel()` ã®ãƒœãƒ¼ãƒ€ãƒ¼å€¤ãƒ†ã‚¹ãƒˆï¼ˆnoEditRate 0.8/0.4, avgRetries 0.5/2ï¼‰
  - `VocabularyService` SRS ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¨ˆç®—ã®ãƒ†ã‚¹ãƒˆï¼ˆSM-2 å„ãƒ•ã‚§ãƒ¼ã‚ºï¼‰
  - `StreakNotifier.updateStreak()` ã®ç¶™ç¶š/æ–­çµ¶ä¸¡ã‚±ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆ
  - _Requirements: 5.2, 5.3, 6.4, 7.1, 7.2_

- [ ] 13.2 Widget ãƒ†ã‚¹ãƒˆï¼ˆ`flutter_test`ï¼‰
  - `MessageBubble` â€” ãƒ¦ãƒ¼ã‚¶ãƒ¼/ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å¹ãå‡ºã—ã®è¡¨ç¤ºç¢ºèª
  - `ReplyPanel` â€” è§£èª¬ãƒ»ã‚¹ãƒ©ãƒ³ã‚°ãƒ‘ãƒãƒ«ã®å±•é–‹/æŠ˜ã‚ŠãŸãŸã¿ç¢ºèª
  - `StreakBar` â€” ã‚¹ãƒˆãƒªãƒ¼ã‚¯æ•°å€¤ã®è¡¨ç¤ºç¢ºèª
  - _Requirements: 3.3, 3.7, 7.3_

- [ ] 13.3 çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆ`integration_test`ï¼‰
  - `generateReply` â€” Edge Function ãƒ¢ãƒƒã‚¯ã§å…¨ãƒ•ãƒ­ãƒ¼ï¼ˆèªè¨¼ãƒ»åˆ¶é™ãƒã‚§ãƒƒã‚¯ãƒ»ç”Ÿæˆãƒ»ä¿å­˜ï¼‰ãƒ†ã‚¹ãƒˆ
  - Stripe Webhook Handler â€” `checkout.session.completed` ã‚¤ãƒ™ãƒ³ãƒˆã§ `plan=pro` ã«ãªã‚‹ãƒ†ã‚¹ãƒˆ
  - ã‚·ãƒŠãƒªã‚ªé€²æ— â€” `arc_day=7` å®Œäº†æ™‚ã« `arc_week+1` + `arc_day=1` ã«ãªã‚‹ãƒ†ã‚¹ãƒˆ
  - _Requirements: 3.1, 3.4, 4.3, 8.4_

---

## è¦ä»¶ã‚«ãƒãƒ¬ãƒƒã‚¸ç¢ºèª

| è¦ä»¶ã‚°ãƒ«ãƒ¼ãƒ— | ã‚«ãƒãƒ¼ã™ã‚‹ã‚¿ã‚¹ã‚¯ |
|------------|----------------|
| 1 (èªè¨¼) | 2.1, 2.2, 2.3 |
| 2 (ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°) | 3.1, 3.2, 3.3 |
| 3 (AIãƒãƒ£ãƒƒãƒˆ) | 4.1, 4.2, 4.3, 4.4 |
| 4 (ã‚·ãƒŠãƒªã‚ª) | 5.1, 5.2, 5.3, 5.4 |
| 5 (é›£æ˜“åº¦) | 6.1, 6.2 |
| 6 (èªžå½™å¸³) | 7.1, 7.2 |
| 7 (ã‚¹ãƒˆãƒªãƒ¼ã‚¯) | 8.1, 8.2 |
| 8 (èª²é‡‘) | 9.1, 9.2, 9.3 |
| 9 (é€šçŸ¥) | 10.1, 10.2 |
| 10 (ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£) | 1.2, 2.3, 12.1, 12.2 |

## å®Œäº†ã‚µãƒžãƒªãƒ¼ï¼ˆ2026-02-26 æ™‚ç‚¹ï¼‰

| # | ã‚¿ã‚¹ã‚¯ | çŠ¶æ…‹ |
|---|--------|------|
| 1 | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŸºç›¤ | âœ… å®Œäº† |
| 2 | èªè¨¼ï¼ˆGoogle/Appleï¼‰ | âœ… å®Œäº†ï¼ˆDBãƒˆãƒªã‚¬ãƒ¼æœªé©ç”¨ï¼‰ |
| 3 | ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ã‚¿ãƒ– | âœ… ã‚¹ã‚¿ãƒ–å®Œäº† |
| 4 | AIãƒãƒ£ãƒƒãƒˆç”Ÿæˆ | âœ… å®Œäº†ï¼ˆè©³ç´°ç¢ºèªæ®‹ï¼‰ |
| 5 | ã‚·ãƒŠãƒªã‚ªã‚·ã‚¹ãƒ†ãƒ  | âŒ æœªç€æ‰‹ |
| 6 | é›£æ˜“åº¦ã‚¨ãƒ³ã‚¸ãƒ³ | âŒ æœªç€æ‰‹ |
| 7 | èªžå½™å¸³ | ðŸ”¶ ã‚¹ã‚¿ãƒ–ã®ã¿ |
| 8 | ã‚¹ãƒˆãƒªãƒ¼ã‚¯ | ðŸ”¶ UIã‚¹ã‚¿ãƒ–ã®ã¿ |
| 9 | Stripeèª²é‡‘ | âŒ æœªç€æ‰‹ |
| 10 | FCMé€šçŸ¥ | âŒ æœªç€æ‰‹ |
| 11 | ãƒ›ãƒ¼ãƒ ãƒ»è¨­å®šã‚¹ã‚¿ãƒ– | âœ… å®Œäº† |
| 12 | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»æœ€é©åŒ– | âŒ æœªç€æ‰‹ |
| 13 | ãƒ†ã‚¹ãƒˆ | âŒ æœªç€æ‰‹ |
